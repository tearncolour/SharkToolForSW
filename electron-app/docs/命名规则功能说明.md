# 文件命名和搜索功能说明

## 功能概述

全新的可视化命名规则系统，支持拖拽式模板构建、全局搜索替换和实时预览，实现文件名的标准化和批量管理。

## 主要功能

### 1. 全局搜索替换 ⭐新增

**位置：** 项目面板顶部

**功能：**
- 在整个项目中搜索文件名
- 支持正则表达式和普通文本搜索
- 区分大小写选项
- 显示所有匹配文件
- 一键全部替换
- 点击结果直接定位文件

**使用场景：**
- 快速查找特定模式的文件
- 全局统一修改文件名前缀/后缀
- 批量修正拼写错误

---

## 核心功能

### 2. 可视化命名模板构建器 ⭐重构

**访问方式：** 
- 虚拟文件夹右键 → "设置命名规则"
- 虚拟文件夹右键 → "批量重命名"（已合并）

**可拖拽组件：**
- **原文件名** 📁 - 保留原始文件名
- **前缀** 🏷️ - 自定义文本前缀
- **后缀** 🏷️ - 自定义文本后缀  
- **序号** 🔢 - 自动编号（可配置起始值和位数）
- **日期** 📅 - 当前日期（格式：YYYYMMDD）
- **作者** 👤 - 当前系统用户名

**使用方法：**
1. 从组件列表拖拽组件到模板框
2. 自由调整组件顺序
3. 为需要输入的组件填写值（前缀/后缀）
4. 配置序号的起始值和位数（如果使用序号组件）
5. 实时查看预览效果
6. 保存并选择是否立即应用到现有文件

**示例组合：**
```
拖拽顺序: [前缀: PRJ_] → [序号] → [后缀: _V1]
原文件: 零件.SLDPRT
结果: PRJ_001_V1.SLDPRT

拖拽顺序: [作者] → [日期] → [后缀: _草图]
原文件: 设计.SLDPRT
结果: Administrator_20251212_草图.SLDPRT

拖拽顺序: [前缀: PROJ_] → [原文件名] → [日期]
原文件: 零件.SLDPRT
结果: PROJ_零件_20251212.SLDPRT
```

**特性：**
- ✅ 可视化拖拽，直观易用
- ✅ 实时预览命名效果
- ✅ 显示前10个文件的重命名对比
- ✅ 支持任意组合和顺序
- ✅ 自动添加分隔符（原文件名后不自动添加）
- ✅ 序号组件可配置起始值和位数
- ✅ 支持多种组件类型（前缀、后缀、序号、日期、作者、原文件名）

### 3. 文件添加时的智能检查

当向虚拟文件夹添加文件时，系统会自动检查文件名是否符合该文件夹的命名规则：

**场景A - 开启自动重命名：**
- 不符合规则的文件自动重命名
- 显示提示信息：`已添加 X 个文件（自动重命名 Y 个）`

**场景B - 未开启自动重命名：**
- 弹出确认对话框，列出所有不符合规则的文件
- 提供两个选项：
  - **重命名：** 按规则重命名文件
  - **保持原名：** 不修改文件名直接添加
- 选择"重命名"后会询问是否"以后都自动重命名"

### 4. 统一的命名和批量重命名

**访问方式：** 虚拟文件夹右键 → "设置命名规则" 或 "批量重命名"（已合并）

**功能整合：**
- ✅ 设置命名规则和批量重命名合二为一
- ✅ 一个对话框完成所有操作
- ✅ 可以只设置规则，不立即应用
- ✅ 可以设置规则并立即批量重命名现有文件
- ✅ 实时预览所有文件的重命名效果

**操作流程：**
1. 打开命名规则对话框
2. 启用规则开关
3. 拖拽构建命名模板
4. 配置序号的起始值和位数（如果使用序号组件）
5. 查看实时预览
6. 勾选"立即重命名现有文件"（可选）
7. 点击"保存并应用"

**优势：**
- 减少操作步骤
- 统一的用户体验
- 避免混淆

### 5. 单个文件重命名（保留）

**访问方式：** 在文件上右键 → "重命名"

**功能不变：**
- 智能识别文件夹命名规则
- 只修改可自定义部分
- 自动保留前缀/后缀

## 技术特性

### 可拖拽界面
- 使用 Vue 3 + vuedraggable
- 流畅的拖拽动画
- 直观的视觉反馈
- 支持组件顺序调整

### 实时预览系统
- 双重预览：示例文件 + 文件列表
- 动态计算命名结果
- 颜色区分新旧名称
- 支持前10个文件的重命名对比

### 模板存储格式
```json
{
  "enabled": true,
  "templateComponents": [
    { "type": "prefix", "value": "PRJ_" },
    { "type": "serial" },
    { "type": "suffix", "value": "_V1" }
  ],
  "autoRename": false,
  "serialStart": 1,
  "serialPadding": 3
}
```

## 数据存储

命名规则保存在 `.shark` 项目文件中，随项目一起保存和加载：

```json
{
  "projectName": "我的项目",
  "virtualTree": {
    "children": [
      {
        "name": "零件文件夹",
        "type": "virtual-folder",
        "namingRule": {
          "enabled": true,
          "templateComponents": [
            { "type": "prefix", "value": "PRJ_" },
            { "type": "serial" },
            { "type": "suffix", "value": "_V1" }
          ],
          "autoRename": false,
          "serialStart": 1,
          "serialPadding": 3
        },
        "children": [...]
      }
    ]
  }
}
```

## 使用场景

### 场景1：项目标准化
```
模板: [前缀: PRJ01_] → [作者] → [序号]
效果: PRJ01_张三_001.SLDPRT
用途: 统一项目文件命名规范
```

### 场景2：版本管理
```
模板: [序号] → [日期] → [后缀: _Draft]
效果: 001_20251212_Draft.SLDPRT
用途: 按日期和序号管理文件版本
```

### 场景3：部门协作
```
模板: [前缀: MECH_] → [日期] → [后缀: _Review]
效果: MECH_20251212_Review.SLDPRT
用途: 区分部门和审核状态
```

### 场景4：保留原文件名
```
模板: [前缀: ARCH_] → [原文件名] → [日期]
效果: ARCH_零件_20251212.SLDPRT
用途: 保留原文件名的同时添加前缀和日期
```

### 场景5：快速搜索替换
```
操作: 全局搜索 "_old" → 替换为 "_new"
效果: 批量更新所有文件名中的文本
用途: 统一修正命名错误
```

## 优势总结

✅ **可视化操作** - 拖拽式界面，无需记忆复杂规则  
✅ **实时预览** - 所见即所得，避免错误  
✅ **功能整合** - 命名规则+批量重命名一体化  
✅ **灵活组合** - 6种组件任意搭配  
✅ **全局搜索** - 快速定位和替换文件名  
✅ **智能检查** - 添加文件时自动验证规则  
✅ **序号配置** - 支持自定义起始值和位数  
✅ **原文件名保留** - 支持保留原始文件名  

## 注意事项

⚠️ 重命名操作会修改磁盘上的实际文件名，请谨慎操作  
⚠️ 建议先查看预览，确认无误后再执行  
⚠️ 序号组件在批量重命名时会自动递增  
⚠️ 日期和作者为动态值，在执行时生成  
⚠️ 模板保存在项目文件中，随项目一起保存  
⚠️ 原文件名组件后不会自动添加分隔符  
⚠️ 组件顺序会影响最终的文件名格式
