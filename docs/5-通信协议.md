# 5. 通信协议

## 5.1 消息格式

**请求消息**：
```json
{
    "id": "unique-message-id",
    "command": "command-name",
    "payload": {
        // 命令参数
    }
}
```

**响应消息**：
```json
{
    "id": "unique-message-id",
    "success": true,
    "data": {
        // 返回数据
    }
}
```

**错误响应**：
```json
{
    "id": "unique-message-id",
    "success": false,
    "message": "错误描述"
}
```

## 5.2 事件消息

插件主动推送的消息：

```json
{
    "type": "document-opened",
    "payload": {
        "name": "Part1.SLDPRT",
        "path": "C:\\Projects\\Part1.SLDPRT"
    }
}
```

```json
{
    "type": "history-update",
    "payload": {
        "records": [...]
    }
}
```

## 5.3 连接管理

**身份标识**（插件连接后发送）：
```json
{
    "type": "identify",
    "client": "solidworks"
}
```

**连接确认**（Electron 返回）：
```json
{
    "type": "connected"
}
```