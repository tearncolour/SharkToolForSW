# 工程文件结构说明

## 1. 项目根目录结构

```
SharkToolForSW/
├── docs/                  # 项目文档目录
├── electron-app/          # Electron 客户端应用
├── scripts/               # PowerShell 脚本文件
├── sharktools/            # SolidWorks 插件端
├── readme.md              # 项目主文档
```

## 2. 主要目录说明

### 2.1 docs/

项目文档目录，包含所有详细的项目文档，按功能模块和主题分类。

| 文件名 | 描述 |
|--------|------|
| 1-项目概述.md | 项目简介、技术栈和主要功能 |
| 2-系统架构.md | 整体架构图和通信流程 |
| 3-插件端.md | SolidWorks 插件端详细说明 |
| 4-客户端.md | Electron 客户端详细说明 |
| 5-通信协议.md | WebSocket 通信协议格式 |
| 6-功能模块.md | 主要功能模块说明 |
| 7-数据存储.md | 数据存储方案说明 |
| 8-安装与部署.md | 安装和部署指南 |
| 9-开发指南.md | 开发流程和调试方法 |
| 10-API参考.md | API 接口参考文档 |
| 附录.md | 错误代码、文件类型和快捷键 |
| 工程文件结构说明.md | 本文件，项目文件结构说明 |

### 2.2 electron-app/

Electron 客户端应用，提供现代化的用户界面和扩展功能。

```
electron-app/
├── main.js              # Electron 主进程入口
├── preload.js           # 预加载脚本（安全桥接）
├── package.json         # 项目配置和依赖
├── vite.config.js       # Vite 构建配置
├── renderer/            # 渲染进程（Vue 应用）
├── node_modules/        # npm 依赖包
└── workers/             # Web Worker 文件
```

**关键文件说明**：
- `main.js`：Electron 主进程，处理窗口管理、WebSocket 服务器和 IPC 通信
- `preload.js`：安全的上下文桥接，用于渲染进程和主进程之间的通信
- `renderer/`：Vue 3 应用，包含所有前端组件和业务逻辑
- `workers/`：Web Worker，用于处理耗时操作如文件转换和 3D 渲染

### 2.3 scripts/

PowerShell 脚本集合，用于 SolidWorks 检测、API 文件夹查找等辅助功能。

| 脚本名 | 描述 |
|--------|------|
| detect_api_folder.ps1 | 检测 SolidWorks API 文件夹 |
| detect_solidworks.ps1 | 检测 SolidWorks 安装 |
| detect_sw_on_d.ps1 | 检测 D 盘上的 SolidWorks 安装 |
| detect_sw_registry_path.ps1 | 从注册表检测 SolidWorks 路径 |
| list_api_dirs.ps1 | 列出所有 API 目录 |
| search_interop_d.ps1 | 在 D 盘搜索 Interop 程序集 |
| verify_redist_files.ps1 | 验证 redistributable 文件 |

### 2.4 sharktools/

SolidWorks 插件端，以 COM Add-in 形式集成到 SolidWorks 中。

```
sharktools/
├── BatchRenameManager.cs       # 批量重命名管理器
├── Connect.cs                  # Add-in 入口点，ISwAddin 实现
├── CustomPropertyManager.cs    # 自定义属性管理
├── ElectronServer.cs           # WebSocket 通信客户端
├── EnhancedHistoryTracker.cs   # 增强历史记录追踪器
├── FileCompareManager.cs       # 文件对比管理
├── GitHubAuth.cs               # GitHub OAuth 认证
├── HistoryDatabase.cs          # LiteDB 数据库管理
├── ModelConverter.cs           # 模型格式转换器
├── ProjectManager.cs           # 项目文件夹管理
├── SharkCommandManager.cs      # 命令管理器，创建工具栏和菜单
├── SharkTools.csproj           # 项目文件
├── bin/                        # 编译输出目录
├── obj/                        # 编译中间文件
├── Properties/                 # 程序集属性
└── ui/                         # WebView UI 文件
```

**核心类说明**：
- `Connect.cs`：插件入口，实现 ISwAddin 接口，负责初始化和连接 SolidWorks
- `SharkCommandManager.cs`：命令管理器，创建 SolidWorks 工具栏和菜单
- `ElectronServer.cs`：WebSocket 客户端，处理与 Electron 的通信
- `EnhancedHistoryTracker.cs`：增强历史记录追踪器，定时检测特征树变化
- `CustomPropertyManager.cs`：自定义属性管理器，处理文件属性的读写操作
- `BatchRenameManager.cs`：批量重命名管理器，支持多种命名模板
- `ProjectManager.cs`：项目文件夹管理器，处理项目的创建和管理

## 3. 编译输出目录

### 3.1 sharktools/bin/

插件编译输出目录，包含不同配置和平台的编译结果：

```
bin/
├── Debug/              # Debug 配置输出
├── Release/            # Release 配置输出
├── x64/                # 64位平台输出
│   ├── Debug/          # 64位 Debug 输出
│   └── Release/        # 64位 Release 输出
└── x86/                # 32位平台输出
    ├── Debug/          # 32位 Debug 输出
    └── Release/        # 32位 Release 输出
```

每个输出目录包含：
- 插件 DLL 文件（SharkTools.dll）
- 依赖库（LiteDB.dll, Newtonsoft.Json.dll, websocket-sharp.dll 等）
- WebView2 相关 DLL 文件
- UI 文件（HTML, CSS, JS）
- 图标和资源文件

## 4. 前端组件结构

### 4.1 electron-app/renderer/components/

Vue 3 组件目录，包含所有前端 UI 组件：

| 组件名 | 描述 |
|--------|------|
| FileExplorer.vue | 文件资源管理器 |
| HistoryPanel.vue | 历史记录面板 |
| HistoryDiffViewer.vue | 历史对比查看器 |
| GitPanel.vue | Git 版本控制面板 |
| PreviewPanel.vue | 文件预览面板 |
| SettingsPanel.vue | 设置面板 |
| PropertyPanel.vue | 自定义属性面板 |
| RenamePanel.vue | 批量重命名面板 |
| ComparePanel.vue | 文件对比面板 |
| PdfViewer.vue | PDF 查看器 |
| TextEditor.vue | 文本编辑器 |
| GlobalSearchReplace.vue | 全局搜索替换 |
| ProjectManagerPanel.vue | 项目管理器面板 |
| NamingTemplateBuilder.vue | 命名模板构建器 |
| QuickMaterialModal.vue | 快速材料设置模态框 |
| VirtualFileExplorer.vue | 虚拟文件资源管理器 |
| CreateProjectModal.vue | 创建项目模态框 |
| FileIcon.vue | 文件图标组件 |

## 5. 通信架构

项目采用 WebSocket 通信架构，实现 SolidWorks 插件和 Electron 客户端之间的双向通信：

- **插件端**：ElectronServer.cs 作为 WebSocket 客户端，连接到 Electron 服务器
- **客户端**：main.js 中启动 WebSocket 服务器，监听端口 52789
- **通信协议**：JSON 格式消息，包含命令、参数和返回数据

## 6. 数据存储

- **插件端**：使用 LiteDB 嵌入式数据库存储历史记录和项目信息
- **客户端**：使用 electron-store 进行本地配置和状态存储
- **项目配置**：使用 .sharkproject JSON 文件存储项目配置

## 7. 技术栈

| 组件 | 技术 | 版本 |
|------|------|------|
| 插件端 | C# / .NET Framework | 4.7.2 |
| 客户端 | Electron | 28 |
| 前端框架 | Vue | 3 |
| UI 组件库 | Ant Design Vue | 4 |
| JSON 序列化 | Newtonsoft.Json | - |
| 数据库 | LiteDB | - |
| WebSocket | WebSocketSharp | - |
| 3D 渲染 | Three.js / occt-import-js | - |

## 8. 索引

- [返回主文档](../readme.md)
- [1. 项目概述](1-项目概述.md)
- [2. 系统架构](2-系统架构.md)
- [3. 插件端](3-插件端.md)
- [4. 客户端](4-客户端.md)
- [5. 通信协议](5-通信协议.md)
- [6. 功能模块](6-功能模块.md)
- [7. 数据存储](7-数据存储.md)
- [8. 安装与部署](8-安装与部署.md)
- [9. 开发指南](9-开发指南.md)
- [10. API 参考](10-API参考.md)
- [附录](附录.md)
