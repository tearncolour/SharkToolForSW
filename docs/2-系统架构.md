# 2. 系统架构

## 2.1 整体架构图

```
+------------------+        WebSocket        +------------------+
|   SolidWorks     |<----------------------->|    Electron      |
|   (主程序)       |                         |    (客户端)      |
+--------+---------+                         +--------+---------
         |                                            |
         | COM Interop                                | IPC
         |                                            |
+--------+---------+                         +--------+---------
| SharkTools.dll   |                         |   main.js        |
| (Add-in 插件)    |                         |   (主进程)       |
+--------+---------+                         +--------+---------
         |                                            |
         | LiteDB                                     | Vue 3
         |                                            |
+--------+---------+                         +--------+---------
|  history.db      |                         |   renderer/      |
|  (历史数据库)    |                         |   (渲染进程)     |
+------------------+                         +------------------+
```

## 2.2 通信流程

1. SolidWorks 启动时加载 SharkTools.dll
2. 插件初始化 `ElectronServer`，作为 WebSocket 客户端
3. Electron 应用启动 WebSocket 服务器监听端口 52789
4. 插件连接到 Electron 服务器，建立双向通信
5. 用户操作通过 IPC 传递到主进程，再通过 WebSocket 发送给插件
6. 插件执行 SolidWorks API 操作，将结果返回给 Electron