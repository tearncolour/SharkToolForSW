<!doctype HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">

<html>

<!--(==============================================================)-->
<!--(Document created with RoboEditor. )============================-->
<!--(==============================================================)-->

<head>

<title>Get Object's Persistent Reference ID Example (C++)</title>

<!--(Meta)==========================================================-->

<meta http-equiv=content-type content="text/html; charset=windows-1252">

<meta name=MS-HKWD content="C++ examples">
<meta name=MS-HKWD content="C++ examples, ISafeArrayUtility">
<meta name=MS-HKWD content="C++ examples, IDispatch">
<meta name=MS-HKWD content="C++ examples, QueryInterface">
<meta name=MS-HKWD content="C++ examples, persistent reference IDs">
<meta name=generator content="RoboHELP by eHelp Corporation - www.ehelp.com">
<meta name=generator-major-version content=0.1>
<meta name=generator-minor-version content=1>
<meta name=filetype content=kadov>
<meta name=filetype-version content=1>
<meta name=page-count content=1>
<meta name=layout-height content=4185>
<meta name=layout-width content=804>


<!--(Links)=========================================================-->

<link rel="StyleSheet" href="./APIHelp.css">



<style type="text/css">
.auto-style1 {
	font-family: "Courier New", Courier, monospace;
	font-size: 10pt;
}
.auto-style2 {
	color: #008000;
}
</style>



</head>

<!--(Body)==========================================================-->


<body>

<h1><span style="font-weight: normal; font-size: 7.5pt;">SOLIDWORKS API Help</span></h1>

<h1><a name=Top></a>Get Object's Persistent Reference ID Example (C++)</h1>

<p>This example shows how to:</p>
<ul>
	<li><font face="Verdana" style="font-size: 8pt">get the selected object's persistent reference 
 ID using IModelDocExtension::GetPersistReference3. </font></li>
	<li><font face="Verdana" style="font-size: 8pt">use the ISafeArrayUtility to parse the 
Variant SafeArray returned by IModelDocExtension::GetPersistReference3.</font></li>
	<li><font face="Verdana" style="font-size: 8pt">get the size of the persistent 
	reference ID for the selected object.</font></li>
</ul>
<pre style="font-family: Courier New; font-size: 13; color: black; background: white"><span style="color:green;">//-----------------------------------------</span>
<span style="color:green;">//&nbsp;Preconditions:&nbsp;</span>
<span style="color:green;">//&nbsp;1.&nbsp;<span class="auto-style1"><span class="auto-style2">Start Microsoft Visual Studio 2019 or later.</span>
<span class="auto-style2">//    a. Click <strong>File &gt; New &gt; Project &gt; (C++ Windows) Console App</strong>.</span>
<span class="auto-style2">//    b. Click <strong>Next</strong>.</span>
<span class="auto-style2">//    c. Type the name of your project in <strong>Project Name</strong>.</span>
<span class="auto-style2">//    d. Click <strong>Create</strong>.</span>
<span class="auto-style2">//    e. Right-click project, select <strong>Add</strong>, <strong>New Item</strong>, Select <strong>ATL &gt; ATL Suppor</strong>t, Click <strong>Add</strong>.</span>
<span class="auto-style2">//    f. Click <strong>Project &gt; projectname Properties &gt; Configuration Properties &gt; </strong></span><strong>
</strong><span class="auto-style2">//<strong>       C/C++</strong> and type the path to <strong>sldworks.tlb</strong> and <strong>swconst.tlb</strong>, </span>
<span class="auto-style2">//       typically <strong>C:\Program Files\SOLIDWORKS Corp\SOLIDWORK</strong>S, </span>
<span class="auto-style2">//       in Additional Include Directories.</span>
<span class="auto-style2">//    g. Click <strong>Apply</strong> or <strong>OK</strong>.</span>
<span class="auto-style2">// 2. Replace the code in the code<strong> </strong>window with<strong> This code.</strong></span><strong>
</strong><span class="auto-style2">//<strong> </strong>3.<strong> </strong>Click<strong> Debug &gt; Start Debugging</strong>.</span></span></span> 
<span style="color:green;">//</span>
<span style="color:green;">//&nbsp;Postconditions:&nbsp;</span>
<span style="color:green;">//&nbsp;1.&nbsp;Gets&nbsp;each&nbsp;byte&nbsp;value in&nbsp;a&nbsp;Variant&nbsp;SafeArray&nbsp;of&nbsp;byte&nbsp;values
//    of the persistent reference ID.</span>
<span style="color:green;">//&nbsp;2.&nbsp;Displays&nbsp;a&nbsp;message&nbsp;box&nbsp;showing&nbsp;the&nbsp;size&nbsp;of&nbsp;of&nbsp;the&nbsp;persistent</span>
<span style="color:green;">//&nbsp;&nbsp;&nbsp;&nbsp;reference&nbsp;ID&nbsp;assigned&nbsp;to&nbsp;the&nbsp;selected&nbsp;object.</span>
<span style="color:green;">//&nbsp;3.&nbsp;Click&nbsp;<b>OK</b>&nbsp;to&nbsp;close&nbsp;the&nbsp;message&nbsp;box.</span>
<span style="color:green;">//-----------------------------------------</span>
<span style="color: #008000"><a name="ThisCode"></a>//<strong>This code</strong></span>
 
<span style="color:blue;">#include</span>&nbsp;<span style="color:#a31515;">&quot;framework.h&quot;</span>
<span style="color:blue;">#include</span>&nbsp;<span style="color:#a31515;">&lt;string&gt;</span>
 
<span style="color:blue;">#import</span>&nbsp;<span style="color:#a31515;">&quot;sldworks.tlb&quot;</span>&nbsp;raw_interfaces_only,&nbsp;raw_native_types,&nbsp;no_namespace,&nbsp;named_guids&nbsp;<span style="color:green;">//SOLIDWORKS&nbsp;type&nbsp;library</span>
<span style="color:blue;">#import</span>&nbsp;<span style="color:#a31515;">&quot;swconst.tlb&quot;</span>&nbsp;no_namespace,&nbsp;raw_native_types,&nbsp;no_namespace,&nbsp;named_guids&nbsp;<span style="color:green;">//SOLIDWORKS&nbsp;constants&nbsp;type&nbsp;library</span>
 
<span style="color:blue;">template</span>&nbsp;&lt;<span style="color:blue;">typename</span>&nbsp;T&gt;
std::string&nbsp;number_to_string(T&nbsp;number)
{
		<span style="color:blue;">return</span>&nbsp;<span style="color:blue;">dynamic_cast</span>&lt;std::stsringstream&nbsp;*&gt;&nbsp;(&amp;(std::stringstream()&nbsp;&lt;&lt;&nbsp;number))-&gt;str();
}
 
<span style="color:blue;">int</span>&nbsp;_tmain(<span style="color:blue;">int</span>&nbsp;argc,&nbsp;TCHAR*&nbsp;argv[])
{
 
		<span style="color:green;">//Initialize&nbsp;COM</span>
		<span style="color:green;">//Do&nbsp;this&nbsp;before&nbsp;using&nbsp;ATL&nbsp;smart&nbsp;pointers&nbsp;so&nbsp;that</span>
		<span style="color:green;">//COM&nbsp;is&nbsp;available</span>
		CoInitialize(NULL);
 
		<span style="color:green;">//Use&nbsp;a&nbsp;block&nbsp;so&nbsp;that&nbsp;the&nbsp;smart&nbsp;pointers&nbsp;are&nbsp;destructed&nbsp;when</span>
		<span style="color:green;">//scope&nbsp;of&nbsp;this&nbsp;block&nbsp;is&nbsp;exited</span>
		{
			<span style="color:green;">//Use&nbsp;ATL&nbsp;smart&nbsp;pointers</span>
			CComPtr&lt;ISldWorks&gt;&nbsp;swApp;
			<span style="color:blue;">if</span>(swApp.CoCreateInstance(L<span style="color:#a31515;">&quot;SldWorks.Application&quot;</span>,&nbsp;NULL,&nbsp;CLSCTX_LOCAL_SERVER)&nbsp;!=&nbsp;S_OK){
					<span style="color:blue;">return</span>(0);
			}&nbsp;
 
			CComPtr&lt;IModelDoc2&gt;&nbsp;swDoc;
			swApp-&gt;<b>get_IActiveDoc2</b>(&amp;swDoc);&nbsp;
 
			CComPtr&lt;IModelDocExtension&gt;&nbsp;swDocExt;
			swDoc-&gt;<b>get_Extension</b>(&amp;swDocExt);&nbsp;
 
			CComPtr&lt;ISelectionMgr&gt;&nbsp;swSelMgr;
			swDoc-&gt;<b>get_ISelectionManager</b>(&amp;swSelMgr);&nbsp;
 
			CComPtr&lt;IDispatch&gt;&nbsp;disp;
			swSelMgr-&gt;<b>GetSelectedObject6</b>(1,&nbsp;-1,&nbsp;&amp;disp);&nbsp;
 
			<span style="color:green;">//Get&nbsp;the&nbsp;persistent&nbsp;reference&nbsp;ID&nbsp;for&nbsp;the&nbsp;selected&nbsp;object</span>
			_variant_t&nbsp;varPersist;
			::VariantInit(&amp;varPersist);
			swDocExt-&gt;<b>GetPersistReference3</b>(disp,&nbsp;&amp;varPersist);&nbsp;
 
			CComPtr&lt;IDispatch&gt;&nbsp;pDispatchSafeArray&nbsp;=&nbsp;NULL;
			CComPtr&lt;ISafeArrayUtility&gt;&nbsp;swSafeArray&nbsp;=&nbsp;NULL;
			HRESULT&nbsp;hres;
			hres&nbsp;=&nbsp;swApp-&gt;<b>GetSafeArrayUtility</b>(&amp;pDispatchSafeArray);
			hres&nbsp;=&nbsp;pDispatchSafeArray.QueryInterface&lt;ISafeArrayUtility&gt;(&amp;swSafeArray);
 
			<span style="color:blue;">long</span>&nbsp;sizePersistIDs;
			swDocExt-&gt;<b>GetPersistReferenceCount3</b>(disp,&nbsp;&amp;sizePersistIDs);
 
			<span style="color:blue;">for</span>(<span style="color:blue;">int</span>&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;sizePersistIDs;&nbsp;i++){
				byte&nbsp;byteValue;
				<span style="color:green;">//Get&nbsp;each&nbsp;byte&nbsp;value in&nbsp;the&nbsp;Variant&nbsp;SafeArray&nbsp;of&nbsp;byte&nbsp;values</span>
				swSafeArray-&gt;<b>GetByte</b>(varPersist,&nbsp;i,&nbsp;&amp;byteValue);
				<span style="color:green;">//TODO:&nbsp;Do&nbsp;something&nbsp;with&nbsp;each&nbsp;persistent&nbsp;reference&nbsp;ID</span>
			}
 
			_bstr_t&nbsp;s;
			s&nbsp;=&nbsp;(<span style="color:blue;">long</span>)sizePersistIDs;
			CComBSTR&nbsp;msg;
			msg&nbsp;=&nbsp;(OLESTR(<span style="color:#a31515;">&quot;Size&nbsp;of&nbsp;persistent&nbsp;reference&nbsp;ID:&nbsp;&quot;</span>));
			msg.AppendBSTR(s);
			<span style="color:blue;">long</span>&nbsp;res;
			<span style="color:green;">//Pop&nbsp;up&nbsp;a&nbsp;message&nbsp;box&nbsp;with&nbsp;the&nbsp;size&nbsp;of&nbsp;persistent</span>
			<span style="color:green;">//reference&nbsp;ID&nbsp;for&nbsp;the&nbsp;selected&nbsp;object</span>
			swApp-&gt;<b>SendMsgToUser2</b>(msg,&nbsp;0,&nbsp;0,&nbsp;&amp;res);
 
		}
	
		<span style="color:green;">//ATL&nbsp;smart&nbsp;pointers&nbsp;are&nbsp;destructed&nbsp;so&nbsp;that&nbsp;all&nbsp;COM&nbsp;objects</span>
		<span style="color:green;">//held&nbsp;on&nbsp;to&nbsp;are&nbsp;released</span>
		<span style="color:green;">//Shut&nbsp;down&nbsp;COM&nbsp;because&nbsp;you&nbsp;no&nbsp;longer&nbsp;need&nbsp;it</span>
		CoUninitialize();
 
		<span style="color:blue;">return</span>(0);
 
}</pre>

</body>

</html>
