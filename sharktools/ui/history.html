<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SharkTools å†å²è®°å½•</title>
    <link rel="stylesheet" href="history.css">
</head>
<body>
    <div id="app">
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <div class="header">
            <button class="back-button" @click="goBack">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M19 12H5M12 19l-7-7 7-7" stroke-width="2" stroke-linecap="round"/>
                </svg>
                è¿”å›ä¸»ç•Œé¢
            </button>
            <h1 class="title">å†å²è®°å½•</h1>
        </div>

        <!-- æ–‡æ¡£ä¿¡æ¯å¡ç‰‡ -->
        <div class="doc-info" v-if="documentInfo.name">
            <div class="doc-icon">ğŸ“„</div>
            <div class="doc-details">
                <div class="doc-name">{{ documentInfo.name }}</div>
                <div class="doc-path">{{ documentInfo.path }}</div>
                <div class="doc-stats">
                    å…± {{ records.length }} æ¡è®°å½• Â· æœ€åæ›´æ–° {{ lastUpdated }}
                </div>
            </div>
        </div>

        <!-- åˆ†æ”¯é€‰æ‹©å™¨ -->
        <div class="branch-selector">
            <div class="branch-current" @click="toggleBranchMenu">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="6" y1="3" x2="6" y2="15" stroke-width="2"/>
                    <circle cx="18" cy="6" r="3" stroke-width="2"/>
                    <circle cx="6" cy="18" r="3" stroke-width="2"/>
                    <path d="M18 9a9 9 0 0 1-9 9" stroke-width="2"/>
                </svg>
                <span>{{ currentBranch }}</span>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M6 9l6 6 6-6" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="branch-menu" v-show="showBranchMenu">
                <div class="branch-list">
                    <div 
                        v-for="branch in branches" 
                        :key="branch.name"
                        class="branch-item"
                        :class="{ 'active': branch.name === currentBranch }"
                        @click="switchBranch(branch.name)"
                    >
                        <span class="branch-name">{{ branch.name }}</span>
                        <span class="branch-desc">{{ branch.description }}</span>
                        <button 
                            v-if="branch.name !== 'main'" 
                            class="branch-delete" 
                            @click.stop="deleteBranch(branch.name)"
                            title="åˆ é™¤åˆ†æ”¯"
                        >ğŸ—‘ï¸</button>
                    </div>
                </div>
                <div class="branch-actions">
                    <button class="branch-new-btn" @click="showNewBranchDialog">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="12" y1="5" x2="12" y2="19" stroke-width="2" stroke-linecap="round"/>
                            <line x1="5" y1="12" x2="19" y2="12" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        æ–°å»ºåˆ†æ”¯
                    </button>
                </div>
            </div>
        </div>

        <!-- å›æº¯çŠ¶æ€æç¤º -->
        <div class="rollback-status" v-if="currentRollbackId">
            <div class="rollback-info">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="12" cy="12" r="10" stroke-width="2"/>
                    <path d="M12 6v6l4 2" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>å½“å‰å¤„äºå†å²å›æº¯çŠ¶æ€ï¼Œéƒ¨åˆ†ç‰¹å¾å·²è¢«æŠ‘åˆ¶</span>
            </div>
            <button class="restore-latest-btn" @click="restoreToLatest">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 12a9 9 0 0114.5-7M21 12a9 9 0 01-14.5 7M3 4v5h5M21 20v-5h-5" stroke-width="2" stroke-linecap="round"/>
                </svg>
                æ¢å¤åˆ°æœ€æ–°
            </button>
        </div>

        <!-- æ–°å»ºåˆ†æ”¯å¯¹è¯æ¡† -->
        <div class="modal-overlay" v-show="showNewBranch" @click.self="showNewBranch = false">
            <div class="modal-content">
                <h3>æ–°å»ºåˆ†æ”¯</h3>
                <div class="form-group">
                    <label>åˆ†æ”¯åç§°</label>
                    <input type="text" v-model="newBranchName" placeholder="è¾“å…¥åˆ†æ”¯åç§°">
                </div>
                <div class="form-group">
                    <label>æè¿°</label>
                    <input type="text" v-model="newBranchDesc" placeholder="å¯é€‰æè¿°">
                </div>
                <div class="modal-actions">
                    <button class="btn-cancel" @click="showNewBranch = false">å–æ¶ˆ</button>
                    <button class="btn-primary" @click="createBranch">åˆ›å»º</button>
                </div>
            </div>
        </div>

        <!-- å·¥å…·æ  -->
        <div class="toolbar">
            <div class="search-box">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="11" cy="11" r="8" stroke-width="2"/>
                    <path d="M21 21l-4.35-4.35" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <input 
                    type="text" 
                    v-model="searchQuery" 
                    placeholder="æœç´¢å†å²è®°å½•..."
                    @input="filterRecords"
                />
            </div>
            <button class="toolbar-button" :class="{ 'active': showFilters }" @click="toggleFilters" title="ç­›é€‰">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
            <button class="toolbar-button" @click="exportHistory" title="å¯¼å‡ºå†å²è®°å½•">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
            <button class="toolbar-button" @click="restoreAll" title="æ¢å¤æ‰€æœ‰ç‰¹å¾">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 12a9 9 0 0114.5-7M21 12a9 9 0 01-14.5 7M3 4v5h5M21 20v-5h-5" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>

        <!-- ç­›é€‰é¢æ¿ -->
        <div class="filter-panel" v-show="showFilters">
            <div class="filter-section">
                <div class="filter-title">æ“ä½œç±»å‹</div>
                <div class="filter-options">
                    <label class="filter-checkbox" v-for="type in filterTypes" :key="type.value">
                        <input type="checkbox" v-model="type.checked" @change="filterRecords">
                        <span class="checkmark"></span>
                        <span class="filter-label">{{ type.icon }} {{ type.label }}</span>
                    </label>
                </div>
            </div>
            <div class="filter-section">
                <div class="filter-title">æ—¶é—´èŒƒå›´</div>
                <div class="filter-options time-range">
                    <button 
                        class="time-button" 
                        :class="{ 'active': timeRange === range.value }"
                        v-for="range in timeRanges" 
                        :key="range.value"
                        @click="setTimeRange(range.value)"
                    >
                        {{ range.label }}
                    </button>
                </div>
            </div>
            <div class="filter-actions">
                <button class="filter-clear" @click="clearFilters">æ¸…é™¤ç­›é€‰</button>
            </div>
        </div>

        <!-- å†å²è®°å½•æ—¶é—´è½´ -->
        <div class="timeline-container">
            <div v-if="filteredRecords.length === 0" class="empty-state">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#ccc">
                    <circle cx="12" cy="12" r="10" stroke-width="2"/>
                    <path d="M12 6v6l4 2" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <p>{{ searchQuery ? 'æœªæ‰¾åˆ°åŒ¹é…çš„è®°å½•' : 'æš‚æ— å†å²è®°å½•' }}</p>
            </div>

            <div 
                v-for="(record, index) in filteredRecords" 
                :key="record.id"
                class="timeline-item"
                :class="{ 
                    'important': record.isImportant,
                    'current-position': record.id === currentRollbackId,
                    'suppressed': record.isSuppressed
                }"
                @click="rollbackTo(record)"
            >
                <div class="timeline-marker">
                    <div class="marker-dot"></div>
                    <div class="marker-line" v-if="index < filteredRecords.length - 1"></div>
                </div>

                <div class="timeline-content">
                    <div class="record-header">
                        <div class="record-icon" :class="getTypeClass(record.featureType)">{{ getTypeIcon(record.type, record.featureType) }}</div>
                        <div class="record-info">
                            <div class="record-name">{{ record.name }}</div>
                            <div class="record-meta">
                                <span class="record-type">{{ getTypeLabel(record.type, record.featureType) }}</span>
                                <span class="record-time">{{ formatTime(record.timestamp) }}</span>
                            </div>
                        </div>
                        <div class="record-actions">
                            <button 
                                class="action-button star" 
                                :class="{ 'active': record.isImportant }"
                                @click.stop="toggleImportant(record)"
                                title="æ ‡è®°ä¸ºé‡è¦"
                            >
                                â­
                            </button>
                            <button 
                                class="action-button delete" 
                                @click.stop="deleteRecord(record)"
                                title="åˆ é™¤è®°å½•"
                            >
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                    <div class="record-description" v-if="record.description">
                        {{ record.description }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="history.js"></script>
</body>
</html>
